\begin{tikzpicture}
\usetikzlibrary{plotmarks}
\usetikzlibrary{patterns}
\pgfplotsset{width=\linewidth, height=6cm}
\begin{groupplot}[
    group style={
        group size=4 by 1,
        vertical sep=0pt,
        horizontal sep=0pt,
        xlabels at=edge bottom,
        ylabels at=edge left,
        xticklabels at=edge bottom,
        yticklabels at=edge left,
    },
    ymin=0,
    ymax=4900,
    width=\linewidth / 3.245,
    enlarge x limits=0.3,
    ybar=0,
    /pgf/bar width=3mm,
    /pgfplots/area legend,
    nodes near coords,
    legend style={
        anchor=north west,
        at={(0.02,0.87)},
        cells={anchor=west},
    },
    every node near coord/.append style={
        rotate=90,
        anchor=north,
        font=\tiny,
        xshift=5mm,
        yshift=0.3mm,
    },
    xtick=data,
    xlabel=File size,
    ylabel={Throughput $\left[\si{\kilo\byte\per\second}\right]$},
    symbolic x coords={4 MB, 16 MB, 64 MB}
]
\nextgroupplot
% Write with FUSE
\addplot+[pattern=north west lines, pattern color=blue, error bars/.cd,y dir=both, y explicit] coordinates {
    % Write Null
    (4 MB, 1590) +- (0, 31.62)
    (16 MB, 1160) +- (0, 51.64)
    (64 MB, 579) +- (0, 7.38)
};
\addplot+[pattern=crosshatch dots, pattern color=red, error bars/.cd,y dir=both, y explicit] coordinates {
    % Write RS
    (4 MB, 1090) +- (0, 32.91)
    (16 MB, 770) +- (0, 17.21)
    (64 MB, 392) +- (0, 2.90)
};
\addplot+[pattern=north east lines, pattern color=brown!60!black, error bars/.cd,y dir=both, y explicit] coordinates {
    % Write LRC
    (4 MB, 998) +- (0, 4.37)
    (16 MB, 670) +- (0, 10.28)
    (64 MB, 340) +- (0, 1.41)
};

\legend{No erasure coding, Reed-Solomon, LRC}

% Write direct
\nextgroupplot
\addplot+[pattern=north west lines, pattern color=blue, pattern color=blue, error bars/.cd,y dir=both, y explicit] coordinates {
    % Write Null
    (4 MB, 2999) +- (0, 824.6)
    (16 MB, 3536) +- (0, 289.1)
    (64 MB, 3838) +- (0, 81.1)
};
\addplot+[pattern=crosshatch dots, pattern color=red, error bars/.cd,y dir=both, y explicit] coordinates {
    % Write RS
    (4 MB, 1743) +- (0, 235.5)
    (16 MB, 1874) +- (0, 481.6)
    (64 MB, 2084) +- (0, 264.5)
};
\addplot+[pattern=north east lines, pattern color=brown!60!black, error bars/.cd,y dir=both, y explicit] coordinates {
    % Write LRC
    (4 MB, 1502) +- (0, 287.6)
    (16 MB, 1632) +- (0, 301.6)
    (64 MB, 1817) +- (0, 197.3)
};

\nextgroupplot
% Read with FUSE
\addplot+[pattern=north west lines, pattern color=blue, error bars/.cd,y dir=both, y explicit] coordinates {
    % Read Null
    (4 MB, 930) +- (0, 29.22)
    (16 MB, 1120) +- (0, 43.87)
    (64 MB, 1530) +- (0, 50.26)
};
\addplot+[pattern=crosshatch dots, pattern color=red, error bars/.cd,y dir=both, y explicit] coordinates {
    % Read RS
    (4 MB, 711) +- (0, 13.06)
    (16 MB, 891) +- (0, 40.30)
    (64 MB, 1100) +- (0, 0)
};
\addplot+[pattern=north east lines, pattern color=brown!60!black, error bars/.cd,y dir=both, y explicit] coordinates {
    % Read LRC
    (4 MB, 791) +- (0, 17.56)
    (16 MB, 1011) +- (0, 50.67)
    (64 MB, 1130) +- (0, 50.26)
};

% Read direct
\nextgroupplot
\addplot+[pattern=north west lines, pattern color=blue, error bars/.cd,y dir=both, y explicit] coordinates {
    % Read Null
    (4 MB, 1497) +- (0, 543.6)
    (16 MB, 1899) +- (0, 71.2)
    (64 MB, 1907) +- (0, 34.1)
};
\addplot+[pattern=crosshatch dots, pattern color=red, error bars/.cd,y dir=both, y explicit] coordinates {
    % Read RS
    (4 MB, 1116) +- (0, 411.9)
    (16 MB, 1442) +- (0, 44.8)
    (64 MB, 1419) +- (0, 58.7)
};
\addplot+[pattern=north east lines, pattern color=brown!60!black, error bars/.cd,y dir=both, y explicit] coordinates {
    % Read LRC
    (4 MB, 1296) +- (0, 432.4)
    (16 MB, 1632) +- (0, 24.0)
    (64 MB, 1599) +- (0, 33.1)
};
\end{groupplot}

\node[anchor=north] at (group c1r1.north) {FUSE write};
\node[anchor=north] at (group c3r1.north) {FUSE read};
\node[anchor=north] at (group c2r1.north) {Direct write};
\node[anchor=north] at (group c4r1.north) {Direct read};
\end{tikzpicture}
